pipeline {
    agent any
    environment {
        ENVIROMENT = 'dev'
        DOCKER_IMAGE_NAME  = "react-web:latest"
    }

    stages {
        stage('Checkout branch ') {
            steps {
                script {
                    git branch: 'main', url: "https://github.com/trinhhongthuc/build-reactjs-jenkin.git"
                }
            }
        }

        stage('Build this docker project into Image') {
            steps {
                script {
                    dockerImage = docker.build('${DOCKER_IMAGE_NAME}')
                }
            }
        }

        stage('Run docker image with flags -d') {
            steps {
                script {
                    dockerImage = docker.run("-d -p 8080:5173")
                }
            }
        }
    }

    post {
        always {
            echo "Cleaning up..."
            sh "docker image prune -f "
        }
    }
}